@model CEGA.Models.CierreDiarioViewModel
@{
    ViewData["Title"] = "Cierre Diario";
}

<h3>Cierre diario (@Model.Fecha.ToString("dd/MM/yyyy"))</h3>

<!-- Form 1: Ver (GET) -->
<form method="get" asp-action="CierreDiario" class="row g-2 mb-3">
    <div class="col-auto">
        <input type="date" name="fecha" class="form-control"
               value="@Model.Fecha.ToString("yyyy-MM-dd")" />
    </div>
    <div class="col-auto">
        <button class="btn btn-primary" type="submit">Ver</button>
    </div>
</form>

<!-- Form 2: Guardar Cierre (POST) -->
<form method="post" asp-action="GuardarCierreDiario" class="mb-3">
    @Html.AntiForgeryToken()
    <input type="hidden" name="fecha" value="@Model.Fecha.ToString("yyyy-MM-dd")" />
    <button class="btn btn-success" type="submit">Guardar Cierre</button>
</form>

@if (TempData["Mensaje"] != null)
{
    <div class="alert alert-success">@TempData["Mensaje"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="mb-3">
    <strong>Total Ingresos:</strong> @Model.TotalIngresos.ToString("C") |
    <strong>Total Egresos:</strong> @Model.TotalEgresos.ToString("C") |
    <strong>Balance:</strong> @Model.Balance.ToString("C")
</div>

<div class="row">
    <div class="col-md-6">
        <h5>Ingresos</h5>
        <table class="table table-sm table-bordered align-middle">
            <thead>
                <tr>
                    <th class="text-end">Monto</th>
                    <th style="width: 160px;">Fecha</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Ingresos?.Any() == true)
                {
                    foreach (var i in Model.Ingresos)
                    {
                        <tr>
                            <td class="text-end">@i.Monto.ToString("C")</td>
                            <td>@i.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@i.Descripcion</td>
                        </tr>
                    }
                }
                else
                {
                    <tr><td colspan="3" class="text-muted">Sin ingresos para esta fecha.</td></tr>
                }
            </tbody>
        </table>
    </div>

    <div class="col-md-6">
        <h5>Egresos</h5>
        <table class="table table-sm table-bordered align-middle">
            <thead>
                <tr>
                    <th class="text-end">Monto</th>
                    <th style="width: 160px;">Fecha</th>
                    <th>Concepto</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Egresos?.Any() == true)
                {
                    foreach (var e in Model.Egresos)
                    {
                        <tr>
                            <td class="text-end">@e.Monto.ToString("C")</td>
                            <td>@e.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@e.Concepto</td>
                        </tr>
                    }
                }
                else
                {
                    <tr><td colspan="3" class="text-muted">Sin egresos para esta fecha.</td></tr>
                }
            </tbody>
        </table>
    </div>
</div>
