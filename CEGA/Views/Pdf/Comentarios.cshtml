@model List<CEGA.Models.ComentarioPlano>
@{
    ViewData["Title"] = "Comentarios del Plano";
    var plano = ViewBag.Plano as CEGA.Models.Plano;
    var total = Model?.Count ?? 0;
}

<!-- Header con fondo (Opción A: padding horizontal) -->
<div class="py-4 px-3 px-md-4 text-white mb-4 d-flex flex-wrap align-items-center justify-content-between gap-3"
     style="background: var(--brand-mid); border-radius: .75rem;">
    <div class="text-center text-md-start flex-grow-1 pe-md-3">
        <h2 class="fw-bold mb-2">Comentarios del Plano</h2>
        <p class="mb-0 fs-5">
            Archivo: <span class="fw-semibold">@plano?.NombreArchivo</span>
        </p>
    </div>
    <span class="badge bg-light text-dark fs-6 px-3 py-2 shadow-sm ms-md-1">
        @total comentario(s)
    </span>
</div>

@if (TempData["mensaje"] != null)
{
    <div class="alert alert-success mb-3">@TempData["mensaje"]</div>
}

<div class="row g-4">
    <!-- Formulario -->
    <div class="col-lg-5">
        <div class="card shadow border-0">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="fw-semibold">Agregar nuevo comentario</span>
                <span class="text-muted small">Plano ID: @plano?.Id</span>
            </div>
            <div class="card-body">
                <form asp-action="AgregarComentario" method="post" novalidate>
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="PlanoId" value="@plano?.Id" />

                    <div class="mb-3">
                        <label for="Texto" class="form-label">Comentario</label>
                        <textarea class="form-control" id="Texto" name="Texto" rows="3"
                                  placeholder="Describe el hallazgo, referencia o instrucción..." required></textarea>
                        <div class="form-text">Sé claro y conciso. Evita información duplicada.</div>
                    </div>

                    <div class="row g-3">
                        <div class="col-sm-6">
                            <label for="CoordenadaX" class="form-label">Coordenada X (opcional)</label>
                            <input type="number" step="any" id="CoordenadaX" name="CoordenadaX" class="form-control" placeholder="Ej: 125.4" />
                        </div>
                        <div class="col-sm-6">
                            <label for="CoordenadaY" class="form-label">Coordenada Y (opcional)</label>
                            <input type="number" step="any" id="CoordenadaY" name="CoordenadaY" class="form-control" placeholder="Ej: 72.9" />
                        </div>
                    </div>

                    <div class="d-flex justify-content-end mt-4">
                        <button type="submit" class="btn btn-accent">
                            Guardar comentario
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Lista de comentarios -->
    <div class="col-lg-7">
        <div class="card shadow border-0">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="fw-semibold">Comentarios existentes</span>
                <span class="text-muted small">@total en total</span>
            </div>

            @if (Model != null && Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th style="width:45%;">Texto</th>
                                <th style="width:20%;">Fecha</th>
                                <th style="width:25%;">Coordenadas</th>
                                <th style="width:10%;"></th>
                            </tr>
                        </thead>
                        
                    </table>
                </div>
            }
            else
            {
                <div class="p-4 text-center text-muted">
                    <div class="mb-2 fw-semibold">No hay comentarios para este plano aún.</div>
                    <div>Usa el formulario de la izquierda para registrar el primero.</div>
                </div>
            }
        </div>
    </div>
</div>
