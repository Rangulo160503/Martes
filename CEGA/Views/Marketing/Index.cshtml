@model CEGA.Models.ViewModels.MarketingPageVM
@using CEGA.Models
@using System.Linq


@{
    ViewData["Title"] = "Marketing";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var campCount = Model?.Campanias?.Count() ?? 0;
    var poolCount = Model?.Pools?.Count() ?? 0;
    var cliCount = Model?.Clientes?.Count() ?? 0;
}

@await Html.PartialAsync("_ModuleHeader", (
"Módulo de Marketing",
    "Gestiona <span class='fw-semibold'>campañas</span>, <span class='fw-semibold'>pools de correos</span> y <span class='fw-semibold'>clientes</span>."
))

@await Html.PartialAsync("_Alerts")

<div class="card card-lg">
    <div class="card-header p-0">
        <ul class="nav nav-tabs card-header-tabs nav-fill" id="marketingTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="clientes-tab" data-bs-toggle="tab" data-bs-target="#clientes"
                        type="button" role="tab" aria-controls="clientes" aria-selected="true">
                    Clientes <span class="badge bg-success ms-1">@cliCount</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pool-tab" data-bs-toggle="tab" data-bs-target="#pool"
                        type="button" role="tab" aria-controls="pool" aria-selected="false">
                    Pools de Correos <span class="badge bg-success ms-1">@poolCount</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="camp-tab" data-bs-toggle="tab" data-bs-target="#camp"
                        type="button" role="tab" aria-controls="camp" aria-selected="false">
                    Campañas <span class="badge bg-success ms-1">@campCount</span>
                </button>
            </li>
        </ul>
    </div>

    <div class="card-body">
        <div class="tab-content mt-2">
            <!-- Clientes -->
            <div class="tab-pane fade show active" id="clientes" role="tabpanel" aria-labelledby="clientes-tab">
                @await Html.PartialAsync("Partials/_ClientesPartial",
                                Model?.Clientes ?? Enumerable.Empty<ClienteMarketing>())
            </div>

            <!-- Pools -->
            <div class="tab-pane fade" id="pool" role="tabpanel" aria-labelledby="pool-tab">
                @await Html.PartialAsync("Partials/_PoolsPartial", Model)
            </div>

            <!-- Campañas -->
            <div class="tab-pane fade" id="camp" role="tabpanel" aria-labelledby="camp-tab">
                @{
                    // El partial espera Pools en ViewBag (compatibilidad)
                    ViewBag.Pools = Model?.Pools ?? Enumerable.Empty<PoolCorreo>();
                }
                @await Html.PartialAsync("Partials/_CampaniasPartial",
                Model?.Campanias ?? Enumerable.Empty<CEGA.Models.CampMarketing>())
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
