@model CEGA.Models.ViewModels.TareasPageVM
@{
    ViewData["Title"] = "Tareas";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Contadores seguros
    var totalTareas = Model?.Tareas?.Count ?? 0;
    var totalSinAsignar = Model?.TareasSinAsignar?.Count ?? 0;
    var totalAsignaciones = Model?.Asignaciones?.Count ?? 0;
    var totalComentarios = Model?.Comentarios?.Count ?? 0;   // <-- nuevo
}

<div class="mb-3 text-center">
    <h2 class="mb-1">Módulo de Tareas</h2>
    <p class="text-muted mb-0">Gestión de tareas, asignaciones y reportes.</p>
</div>

<div class="card card-lg">
    <div class="card-header p-0">
        <ul class="nav nav-tabs card-header-tabs nav-fill" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-todas" type="button" role="tab">
                    Todas <span class="badge bg-success ms-1">@totalTareas</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-sinasignar" type="button" role="tab">
                    Sin asignar <span class="badge bg-warning ms-1">@totalSinAsignar</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-empleado" type="button" role="tab">
                    Por empleado
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-asignaciones" type="button" role="tab">
                    Asignaciones <span class="badge bg-dark ms-1">@totalAsignaciones</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-comentarios" type="button" role="tab">
                    Comentarios <span class="badge bg-info ms-1">@totalComentarios</span>
                </button>
            </li>
        </ul>
    </div>

    <div class="card-body">
        @await Html.PartialAsync("_AccionesTareasBar") <!-- usa tus rutas existentes -->

        <div class="tab-content mt-3">
            <div class="tab-pane fade show active" id="tab-todas" role="tabpanel">
                @await Html.PartialAsync("_TareasTodasPartial", Model.Tareas)
            </div>
            <div class="tab-pane fade" id="tab-sinasignar" role="tabpanel">
                @await Html.PartialAsync("_TareasSinAsignarPartial", Model.TareasSinAsignar)
            </div>
            <div class="tab-pane fade" id="tab-empleado" role="tabpanel">
                @await Html.PartialAsync("_TareasPorEmpleadoPartial", Model.TareasPorEmpleado)
            </div>
            <div class="tab-pane fade" id="tab-asignaciones" role="tabpanel">
                @await Html.PartialAsync("_TareasAsignacionesPartial", Model.Asignaciones)
            </div>
            <div class="tab-pane fade" id="tab-comentarios" role="tabpanel">
                @await Html.PartialAsync("_ComentariosProyectoPartial", Model.Comentarios)  <!-- NUEVO -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
